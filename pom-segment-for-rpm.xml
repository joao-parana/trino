<!-- Build RPM using the untarred artifacts -->
<plugin>
    <groupId>io.airlift.maven.plugins</groupId>
    <artifactId>redlinerpm-maven-plugin</artifactId>
    <version>2.1.7</version>
    <extensions>true</extensions>
    <configuration>
        <performCheckingForExtraFiles>false</performCheckingForExtraFiles>
        <packages>
            <package>
                <name>trino-server-rpm</name>
                <nameOverride>trino-server-rpm-${project.version}.noarch.rpm</nameOverride>
                <version>${project.version}</version>
                <release>1</release>
                <group>Applications/Databases</group>
                <description>Trino Server RPM Package.</description>
                <architecture>noarch</architecture>
                <preInstallScriptFile>src/main/rpm/preinstall</preInstallScriptFile>
                <postInstallScriptFile>src/main/rpm/postinstall</postInstallScriptFile>
                <preUninstallScriptFile>src/main/rpm/preremove</preUninstallScriptFile>
                <postUninstallScriptFile>src/main/rpm/postremove</postUninstallScriptFile>
                <dependencies>
                    <dependency>
                        <name>python</name>
                        <version>[2.4,)</version>
                    </dependency>
                    <dependency>
                        <name>/usr/sbin/useradd</name>
                    </dependency>
                    <dependency>
                        <name>/usr/sbin/groupadd</name>
                    </dependency>
                    <dependency>
                        <!-- Used e.g. to generate node.properties -->
                        <name>/usr/bin/uuidgen</name>
                    </dependency>
                    <dependency>
                        <!-- Used e.g. by service launcher -->
                        <name>/usr/bin/sudo</name>
                    </dependency>
                </dependencies>
                <links>
                    <link>
                        <path>/usr/lib/trino/etc</path>
                        <target>/etc/trino</target>
                    </link>
                </links>
                <rules>
                    <rule>
                        <destination>/usr/lib/trino/bin</destination>
                        <base>${server.tar.package}/bin</base>
                        <!-- make sure launcher scripts are executable -->
                        <fileMode>0755</fileMode>
                        <includes>
                            <include>*</include>
                        </includes>
                    </rule>
                    <rule>
                        <destination>/usr/lib/trino/bin</destination>
                        <base>${server.tar.package}/bin</base>
                        <!-- copy sub folders -->
                        <includes>
                            <include>*/**</include>
                        </includes>
                    </rule>
                    <rule>
                        <destination>/etc/init.d</destination>
                        <base>dist/etc/init.d</base>
                        <!-- make sure init.d scripts are executable -->
                        <fileMode>0755</fileMode>
                        <includes>
                            <include>*</include>
                        </includes>
                    </rule>
                    <rule>
                        <destination>/usr/lib/trino/shared</destination>
                        <base>${server.tar.package}/shared</base>
                        <includes>
                            <include>*</include>
                        </includes>
                    </rule>
                    <rule>
                        <!-- This should go to just /usr/lib/trino eventually. But that needs modifying
                        launcher.py in airlift, to have a configurable option for install_path -->
                        <destination>/usr/lib/trino/lib</destination>
                        <base>${server.tar.package}/lib</base>
                        <includes>
                            <include>*</include>
                        </includes>
                    </rule>
                    <rule>
                        <destination>/usr/lib/trino/plugin</destination>
                        <base>${server.tar.package}/plugin</base>
                        <includes>
                            <include>*/*</include>
                        </includes>
                    </rule>
                    <rule>
                        <destination>/etc/trino</destination>
                        <base>dist/config</base>
                        <includes>
                            <include>*</include>
                        </includes>
                        <directives>
                            <directive>config</directive>
                            <directive>noreplace</directive>
                        </directives>
                    </rule>
                    <rule>
                        <destination>/usr/shared/doc/trino</destination>
                        <base>${server.tar.package}</base>
                        <includes>
                            <include>README.txt</include>
                        </includes>
                    </rule>
                    <!-- Add these rules so that .spec knows these dirs are to be removed too on rpm -e -->
                    <rule>
                        <destination>/usr/lib/trino</destination>
                    </rule>
                    <rule>
                        <destination>/usr/lib/trino/lib</destination>
                    </rule>
                </rules>
            </package>
        </packages>
    </configuration>
</plugin>
